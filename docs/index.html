<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Module</title>
</head>
<body>
  <h1>Admin Module</h1>
  
  <form id="adminForm">
    <label>
      Is update needed:
      <input type="checkbox" id="isNeedUpdateAvailableAlret">
    </label>
    <br>
    <label>
      Is force needed:
      <input type="checkbox" id="isForceNeeded">
    </label>
    <br><br>
    <button type="submit">Update</button>
  </form>

  <p id="status"></p>

<script>
  const form = document.getElementById('adminForm');
  const status = document.getElementById('status');

  form.addEventListener('submit', async function(event) {
    event.preventDefault();

    // Get checkbox values
    const isNeedUpdateAvailableAlret = document.getElementById('isNeedUpdateAvailableAlret').checked;
    const isForceNeeded = document.getElementById('isForceNeeded').checked;

    // Create the updated JSON data
    const data = {
      success: true,
      code: 200,
      message: "Success",
      data: {
        isNeedUpdateAvailableAlret: isNeedUpdateAvailableAlret,
        isForceNeeded: isForceNeeded
      }
    };

    // GitHub API credentials
    const token = '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'; // Replace with your GitHub personal access token
    const username = 'jensonjohn001'; // Replace with your GitHub username
    const repo = 'dripSupport'; // Replace with your repository name
    const path = 'docs/settings.json'; // Path to the settings.json file
    const branch = 'main'; // Branch to commit the changes

    try {
      // Get the current file's SHA
      const getFileResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${path}?ref=${branch}`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });
      const fileData = await getFileResponse.json();

      // Update the file content
      const updateResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${path}`, {
        method: 'PUT',
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          message: 'Update settings.json',
          content: btoa(JSON.stringify(data, null, 2)), // Encode the JSON data as base64
          sha: fileData.sha, // Required to update the file
          branch: branch
        })
      });

      if (updateResponse.ok) {
        status.textContent = "Settings updated successfully!";
      } else {
        throw new Error('Failed to update settings');
      }
    } catch (error) {
      console.error('Error:', error);
      status.textContent = "Failed to update settings.";
    }
  });
</script>
  
</body>
</html>
